import{j as e}from"./vendor-ds6wDdAD.js";import{r as f}from"./react-nPrKd0zk.js";import{D as U}from"./decimal-CNRKZ6of.js";import{E as le}from"./employees-D2MDJNGt.js";import{P as w}from"./payroll-Cm_R0hmF.js";import{f as k}from"./formatters-CZgibOAZ.js";import{P as oe,E as je,W as ye}from"./jspdf.es.min-BojTXcBU.js";import{f as Q,T as G,a as _,b as P,c as v,d as V,e as y}from"./table-mW3wA7-p.js";import{c as $,a as ve,C as ge,j as Ne,F as fe,B as C}from"./index-sMHxiCIB.js";import"./employees-DNNZe7Q5.js";/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=$("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=$("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=$("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=$("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=$("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=$("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);function ke(r){const i=[];return!r.calculations||r.calculations.length===0?i.push({code:"NO_CALC",severity:"error",message:"No salary calculations present."}):r.calculations.forEach(t=>{t.net<0&&i.push({code:"NEG_NET",severity:"error",message:`Negative net salary for ${t.employeeName}`,employeeId:t.employeeId}),t.overtime>t.basic*.5&&i.push({code:"HIGH_OT",severity:"warning",message:`Overtime exceeds 50% of basic for ${t.employeeName}`,employeeId:t.employeeId}),(t.adjustmentsTotal||0)<0&&Math.abs(t.adjustmentsTotal||0)>t.baseNet&&i.push({code:"OVER_DEDUCT",severity:"error",message:`Deductions exceed base net for ${t.employeeName}`,employeeId:t.employeeId})}),{batchId:r.id,issues:i,hasErrors:i.some(t=>t.severity==="error"),hasWarnings:i.some(t=>t.severity==="warning")}}function Se(r){const i=r.trim().split(/\r?\n/).filter(d=>d.trim().length>0);if(!i.length)return{rows:[],invalid:0,warnings:0};const[t,...a]=i,n=t.split(",").map(d=>d.trim().toLowerCase()),m={code:n.indexOf("employeecode"),date:n.indexOf("date"),hours:n.indexOf("hours"),overtime:n.indexOf("overtime"),weekend:n.indexOf("weekend"),holiday:n.indexOf("holiday")};if(m.code===-1||m.date===-1)return{rows:[],invalid:a.length,warnings:0};let u=0,x=0;const h=[];return a.forEach(d=>{const c=d.split(","),o=(c[m.code]||"").trim(),g=(c[m.date]||"").trim(),b=new Date(g);if(!o||isNaN(b.getTime())){u++;return}const N=parseFloat(c[m.hours]||"0"),S=parseFloat(c[m.overtime]||"0");if(N<0||S<0){u++;return}const I=m.weekend!==-1?/(y|yes|true|1)/i.test(c[m.weekend]||""):!1,T=m.holiday!==-1?/(y|yes|true|1)/i.test(c[m.holiday]||""):!1;I&&T&&x++,h.push({employeeCode:o,date:b.toISOString().slice(0,10),hours:N,overtime:S,weekend:I,holiday:T})}),{rows:h,invalid:u,warnings:x}}function Ie(r){const i={};return r.forEach(t=>{i[t.employeeCode]||(i[t.employeeCode]={days:new Set,totalHours:0,overtime:0,weekendOT:0,holidayOT:0});const a=i[t.employeeCode];a.days.add(t.date),a.totalHours+=t.hours,a.overtime+=t.overtime,t.weekend?a.weekendOT+=t.overtime:t.holiday&&(a.holidayOT+=t.overtime)}),i}const Te=({batchId:r})=>{const[i,t]=f.useState(null),[a,n]=f.useState(null),[m,u]=f.useState(!1),x=async h=>{var l;t(null),n(null);const d=(l=h.target.files)==null?void 0:l[0];if(!d)return;const c=await d.text(),{rows:o,invalid:g,warnings:b}=Se(c);if(o.length===0){n("No valid rows parsed. Required columns: employeeCode,date.");return}const N=Q.getAll(),S=new Set(N.map(p=>p.employeeCode)),I=o.filter(p=>S.has(p.employeeCode)||m),T=Ie(I);let s=0;N.forEach(p=>{const E=T[p.employeeCode];E&&(p.attendance={totalDaysWorked:E.days.size,totalHoursWorked:E.totalHours,overtimeHours:E.overtime},s++)});try{localStorage.setItem("nipon_temporary_employees",JSON.stringify(N))}catch{}w.addAttendanceImportAudit(r,{fileName:d.name,updated:s,invalid:g,warnings:b}),t(`Updated ${s} temps. Invalid rows: ${g}${b?`, warnings: ${b}`:""}`)};return e.jsxs("div",{className:"border rounded p-4 space-y-3 bg-white",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Temporary Attendance Import"}),e.jsx("p",{className:"text-xs text-gray-600",children:"CSV columns: employeeCode,date,hours,overtime,(optional weekend,holiday). Invalid rows skipped."}),e.jsxs("div",{className:"flex items-center gap-2 text-[11px]",children:[e.jsx("input",{type:"checkbox",id:"includeUnknown",checked:m,onChange:h=>u(h.target.checked)}),e.jsx("label",{htmlFor:"includeUnknown",children:"Allow unknown employee codes (ignored for update)"})]}),e.jsx("input",{type:"file",accept:".csv,text/csv",onChange:x,className:"text-xs"}),i&&e.jsx("div",{className:"text-xs text-green-600",children:i}),a&&e.jsx("div",{className:"text-xs text-red-600",children:a})]})};async function Ae(r){const i=w.getById(r);if(!i)throw new Error("Batch not found");const t=oe.list(r);if(!t.length)throw new Error("No payslips generated");const a=new je;t.forEach((n,m)=>{m>0&&a.addPage();const u=n.employeeType==="Temporary";a.setFontSize(14),a.text(`${u?"TEMPORARY":"PERMANENT"} PAYSLIP`,14,16),a.setFontSize(10),a.text(`Employee: ${n.employeeName} (${n.employeeId})`,14,26),a.text(`Period: ${n.period.month}/${n.period.year}`,14,32),a.text(`Type: ${n.employeeType||"N/A"}`,14,38);let x=48;a.setFontSize(11),a.text("Earnings / Deductions",14,x),x+=6,a.setFontSize(9),n.lines.filter(d=>d.amount!==0).forEach(d=>{a.text(d.code,14,x),a.text(d.description,30,x);const c=d.type==="deduction"?`- ${d.amount.toFixed(2)}`:d.amount.toFixed(2);a.text(c,170,x,{align:"right"}),x+=5,x>270&&(a.addPage(),x=20)}),x+=4,a.setFontSize(10),a.text(`Gross: ${n.gross.toFixed(2)}`,14,x),x+=5,a.text(`Deductions: ${n.deductions.toFixed(2)}`,14,x),x+=5,a.text(`Net Pay: ${n.net.toFixed(2)}`,14,x),u&&(x+=8,a.setFontSize(8),a.text("Temporary payslip: consolidated earning reflects approved timesheet & allowances.",14,x))}),a.save(`Payslips-${i.month}-${i.year}.pdf`)}const re=({children:r})=>e.jsx("tfoot",{className:"bg-gray-50 font-medium",children:r}),Ee=({children:r,className:i})=>e.jsx("div",{className:`bg-white border rounded-lg shadow-sm ${i||""}`,children:r}),Pe=({children:r,className:i})=>e.jsx("div",{className:i,children:r});function Y(...r){return r.filter(Boolean).join(" ")}const Oe=({onNext:r,payrollData:i,setPayrollData:t})=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Select Period"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium",children:"Month"}),e.jsx("select",{value:i.month,onChange:a=>t(n=>({...n,month:parseInt(a.target.value,10)})),className:"border rounded px-2 py-1 text-sm",children:Array.from({length:12},(a,n)=>n+1).map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium",children:"Year"}),e.jsx("input",{type:"number",value:i.year,onChange:a=>t(n=>({...n,year:parseInt(a.target.value,10)})),className:"border rounded px-2 py-1 text-sm w-28"})]})]}),e.jsx("div",{className:"pt-4 flex justify-end",children:e.jsxs(C,{onClick:()=>r(),children:["Continue ",e.jsx(q,{className:"ml-1 h-4 w-4"})]})})]}),Re=({onNext:r,onBack:i,payrollData:t,setPayrollData:a})=>{const[n,m]=f.useState([]),[u,x]=f.useState(!0);f.useEffect(()=>{(async()=>{const o=(await le.getActiveEmployees()).map(g=>{var b,N,S,I,T,s;return{id:g.id,name:`${g.personalInfo.firstName} ${g.personalInfo.lastName}`,presentDays:((N=(b=t.attendance)==null?void 0:b[g.id])==null?void 0:N.presentDays)??30,absentDays:((I=(S=t.attendance)==null?void 0:S[g.id])==null?void 0:I.absentDays)??0,overtimeHours:((s=(T=t.attendance)==null?void 0:T[g.id])==null?void 0:s.overtimeHours)??0}});m(o),x(!1)})()},[]);const h=(c,o,g)=>{m(b=>b.map(N=>N.id===c?{...N,[o]:g}:N))},d=()=>{const c={};n.forEach(o=>{c[o.id]={presentDays:o.presentDays,absentDays:o.absentDays,overtimeHours:o.overtimeHours}}),a(o=>({...o,attendance:c})),r({attendance:c})};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Review Attendance"}),u?e.jsx("div",{className:"text-sm text-gray-500",children:"Loading employees…"}):e.jsx("div",{className:"overflow-x-auto border rounded",children:e.jsxs(G,{children:[e.jsx(_,{children:e.jsxs(P,{children:[e.jsx(v,{children:"Employee"}),e.jsx(v,{className:"text-center",children:"Present Days"}),e.jsx(v,{className:"text-center",children:"Absent Days"}),e.jsx(v,{className:"text-center",children:"Overtime Hrs"})]})}),e.jsx(V,{children:n.map(c=>e.jsxs(P,{children:[e.jsx(y,{className:"font-medium whitespace-nowrap",children:c.name}),e.jsx(y,{className:"text-center",children:e.jsx("input",{type:"number",min:0,max:31,value:c.presentDays,onChange:o=>h(c.id,"presentDays",parseInt(o.target.value||"0",10)),className:"w-20 border rounded px-1 py-0.5 text-sm text-center"})}),e.jsx(y,{className:"text-center",children:e.jsx("input",{type:"number",min:0,max:31,value:c.absentDays,onChange:o=>h(c.id,"absentDays",parseInt(o.target.value||"0",10)),className:"w-20 border rounded px-1 py-0.5 text-sm text-center"})}),e.jsx(y,{className:"text-center",children:e.jsx("input",{type:"number",min:0,value:c.overtimeHours,onChange:o=>h(c.id,"overtimeHours",parseInt(o.target.value||"0",10)),className:"w-24 border rounded px-1 py-0.5 text-sm text-center"})})]},c.id))})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Te,{batchId:t.id}),t.attendanceImportAudit&&t.attendanceImportAudit.length>0&&e.jsxs("div",{className:"border rounded p-3 bg-gray-50",children:[e.jsx("h4",{className:"text-xs font-semibold mb-1",children:"Attendance Imports"}),e.jsx("ul",{className:"text-[11px] space-y-1 max-h-40 overflow-auto",children:t.attendanceImportAudit.slice().reverse().map(c=>e.jsxs("li",{children:[new Date(c.at).toLocaleString()," – ",c.fileName||"upload"," updated:",c.updated," invalid:",c.invalid,c.warnings?` warn:${c.warnings}`:""]},c.id))})]})]}),e.jsxs("div",{className:"flex justify-between pt-2",children:[e.jsxs(C,{variant:"outline",onClick:i,children:[e.jsx(W,{className:"mr-1 h-4 w-4"}),"Back"]}),e.jsxs(C,{onClick:d,children:["Continue",e.jsx(q,{className:"ml-1 h-4 w-4"})]})]})]})},Fe=({payrollData:r,onNext:i,onBack:t})=>{var I,T,s;const[a,n]=f.useState([]),[m,u]=f.useState(!0),[x,h]=f.useState(r.calculationMode||"Permanent"),[d,c]=f.useState(((I=r.overtimeConfig)==null?void 0:I.regular)||1.25),[o,g]=f.useState(((T=r.overtimeConfig)==null?void 0:T.weekend)||1.5),[b,N]=f.useState(((s=r.overtimeConfig)==null?void 0:s.holiday)||2);f.useEffect(()=>{S()},[]);const S=async()=>{u(!0);const p=(await le.getActiveEmployees()).filter(j=>j.employeeType==="Permanent"),E=Q.getAll().filter(j=>j.status==="Active"),J=(x==="All"?[...p,...E]:x==="Permanent"?p:E).map(j=>{var H,A,z,Z,ee,te;if(j.employeeType==="Permanent"){const B=((A=(H=r.attendance)==null?void 0:H[j.id])==null?void 0:A.presentDays)||30,R=new U(j.compensation.basicSalary).div(30),F=R.mul(B),L=new U(j.compensation.housingAllowance||0),M=new U(j.compensation.transportAllowance||0),D=new U(j.compensation.otherAllowances||0),O=(z=r.attendance)==null?void 0:z[j.id],ce=(O==null?void 0:O.overtimeHours)||0,de=(O==null?void 0:O.weekendOvertimeHours)||0,me=(O==null?void 0:O.holidayOvertimeHours)||0,K=R.div(8),se=K.mul(d).mul(ce).plus(K.mul(o).mul(de)).plus(K.mul(b).mul(me)),xe=((ee=(Z=r.attendance)==null?void 0:Z[j.id])==null?void 0:ee.absentDays)||0,ue=R.mul(xe),he=new U(0),ne=F.plus(L).plus(M).plus(D).plus(se),ae=ue.plus(he),pe=ne.minus(ae);return{employeeId:j.id,employeeName:`${j.personalInfo.firstName} ${j.personalInfo.lastName}`,employeeType:"Permanent",workingDays:B,basic:F.toNumber(),housing:L.toNumber(),transport:M.toNumber(),other:D.toNumber(),overtime:se.toNumber(),gross:ne.toNumber(),deductions:ae.toNumber(),net:pe.toNumber()}}else{const B=Q.calculateEarnings(j),R=(()=>{var M,D;const L=j.compensation.rateType;return L==="Hourly"&&((M=j.attendance)!=null&&M.overtimeHours)&&j.compensation.overtimeRate||L==="Daily"&&((D=j.attendance)!=null&&D.overtimeHours)&&j.compensation.overtimeRate?j.compensation.overtimeRate*j.attendance.overtimeHours:0})(),F=B-R;return{employeeId:j.id,employeeName:`${j.personalInfo.firstName} ${j.personalInfo.lastName}`,employeeType:"Temporary",workingDays:((te=j.attendance)==null?void 0:te.totalDaysWorked)||0,basic:F<0?B:F,housing:0,transport:0,other:0,overtime:R,gross:F+R,deductions:0,net:F+R}}});n(J),u(!1)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Salary Calculations"}),e.jsxs("div",{className:"text-xs flex items-center gap-1",children:[e.jsx("span",{className:"text-gray-500",children:"Mode:"}),e.jsxs("select",{value:x,onChange:l=>{const p=l.target.value;h(p),w.updateCalculationMode(r.id,p)},className:"border rounded px-2 py-1 text-xs",children:[e.jsx("option",{value:"Permanent",children:"Permanent"}),e.jsx("option",{value:"Temporary",children:"Temporary"}),e.jsx("option",{value:"All",children:"All"})]}),e.jsx("button",{onClick:()=>S(),className:"text-blue-600 underline text-xs",children:"Recalculate"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-end text-xs",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block",children:"OT Regular x"}),e.jsx("input",{type:"number",step:"0.01",value:d,onChange:l=>{const p=parseFloat(l.target.value)||1.25;c(p),w.updateOvertimeConfig(r.id,{regular:p})},className:"border rounded px-2 py-1 w-20"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block",children:"OT Weekend x"}),e.jsx("input",{type:"number",step:"0.01",value:o,onChange:l=>{const p=parseFloat(l.target.value)||1.5;g(p),w.updateOvertimeConfig(r.id,{weekend:p})},className:"border rounded px-2 py-1 w-20"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block",children:"OT Holiday x"}),e.jsx("input",{type:"number",step:"0.01",value:b,onChange:l=>{const p=parseFloat(l.target.value)||2;N(p),w.updateOvertimeConfig(r.id,{holiday:p})},className:"border rounded px-2 py-1 w-20"})]}),e.jsx("div",{className:"space-y-1",children:e.jsx("button",{type:"button",onClick:()=>S(),className:"mt-4 text-blue-600 underline",children:"Apply OT Config"})})]}),e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("span",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:[r.month,"/",r.year]})}),m?e.jsx("div",{className:"py-10 text-center text-sm text-gray-500",children:"Calculating…"}):e.jsx("div",{className:"overflow-x-auto border rounded",children:e.jsxs(G,{children:[e.jsx(_,{children:e.jsxs(P,{children:[e.jsx(v,{children:"Employee"}),e.jsx(v,{className:"text-center",children:"Days"}),e.jsx(v,{className:"text-right",children:"Basic"}),e.jsx(v,{className:"text-right",children:"Housing"}),e.jsx(v,{className:"text-right",children:"Transport"}),e.jsx(v,{className:"text-right",children:"Overtime"}),e.jsx(v,{className:"text-right",children:"Gross"}),e.jsx(v,{className:"text-right",children:"Deductions"}),e.jsx(v,{className:"text-right",children:"Net"})]})}),e.jsx(V,{children:a.map(l=>e.jsxs(P,{children:[e.jsx(y,{className:"font-medium",children:l.employeeName}),e.jsx(y,{className:"text-center",children:l.workingDays}),e.jsx(y,{className:"text-right",children:k(l.basic)}),e.jsx(y,{className:"text-right",children:k(l.housing)}),e.jsx(y,{className:"text-right",children:k(l.transport)}),e.jsx(y,{className:"text-right",children:k(l.overtime)}),e.jsx(y,{className:"text-right font-medium",children:k(l.gross)}),e.jsxs(y,{className:"text-right text-red-600",children:[l.deductions>0&&"-",k(l.deductions)]}),e.jsx(y,{className:"text-right font-semibold text-green-600",children:k(l.net)})]},l.employeeId))}),e.jsx(re,{children:e.jsxs(P,{children:[e.jsx(y,{colSpan:8,className:"text-right font-semibold",children:"Total Payroll:"}),e.jsx(y,{className:"text-right font-bold text-green-700",children:k(a.reduce((l,p)=>l+p.net,0))})]})})]})}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(C,{variant:"outline",onClick:t,children:[e.jsx(W,{className:"mr-1 h-4 w-4"}),"Back"]}),e.jsxs(C,{onClick:()=>i({calculations:a}),children:["Continue",e.jsx(q,{className:"ml-1 h-4 w-4"})]})]})]})},$e=[{value:"bonus",label:"Bonus (+)"},{value:"allowance",label:"Allowance (+)"},{value:"overtime",label:"Overtime (+)"},{value:"deduction",label:"Deduction (-)"}],He=({onNext:r,onBack:i,payrollData:t,setPayrollData:a})=>{var T;const[n,m]=f.useState({employeeId:"",type:"bonus",amount:"",reason:""}),[u,x]=f.useState(null),h=((T=t.calculations)==null?void 0:T.map(s=>({id:s.employeeId,name:s.employeeName})))||[],d=t.adjustments||[],[c,o]=f.useState(null),g=()=>{var H;if(o(null),!n.employeeId||!n.amount){o("Employee and amount required");return}const s=parseFloat(n.amount);if(isNaN(s)||s<=0){o("Enter a positive amount");return}const l=(H=t.calculations)==null?void 0:H.find(A=>A.employeeId===n.employeeId);if(!l){o("Calculation missing for employee");return}const p=l.baseNet??l.net-(l.adjustmentsTotal||0);let E=l.adjustmentsTotal||0;if(u){const A=d.find(z=>z.id===u);A&&(E-=A.type==="deduction"?-A.amount:A.amount)}const X=n.type==="deduction"?-s:s,J=E+X,j=p+J;if(n.type==="deduction"&&s>p){o("Deduction exceeds base net pay");return}if(j<0){o("Adjustment would result in negative net pay");return}(n.type==="bonus"||n.type==="allowance")&&s>p*.5&&console.warn("Large positive adjustment (>50% base net)"),u?(w.editAdjustment(t.id,u,{amount:s,reason:n.reason,type:n.type}),x(null)):w.addAdjustment(t.id,{employeeId:n.employeeId,type:n.type,amount:s,reason:n.reason}),a(A=>({...w.getById(A.id)})),m(A=>({...A,amount:"",reason:""}))},b=s=>{w.removeAdjustment(t.id,s),a(l=>({...w.getById(l.id)}))},N=s=>{const l=d.find(p=>p.id===s);l&&(x(s),m({employeeId:l.employeeId,type:l.type,amount:String(l.amount),reason:l.reason||""}))},S=()=>{x(null),m(s=>({...s,amount:"",reason:""}))},I=(t.calculations||[]).map(s=>({id:s.employeeId,name:s.employeeName,baseNet:s.baseNet??s.net-(s.adjustmentsTotal||0),adjustments:s.adjustmentsTotal||0,net:s.net}));return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Adjustments"}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-2 space-y-4",children:[e.jsx("div",{className:"overflow-x-auto border rounded",children:e.jsxs(G,{children:[e.jsx(_,{children:e.jsxs(P,{children:[e.jsx(v,{children:"Employee"}),e.jsx(v,{className:"text-right",children:"Base Net"}),e.jsx(v,{className:"text-right",children:"Adj Delta"}),e.jsx(v,{className:"text-right",children:"New Net"})]})}),e.jsx(V,{children:I.map(s=>e.jsxs(P,{children:[e.jsx(y,{className:"font-medium",children:s.name}),e.jsx(y,{className:"text-right",children:k(s.baseNet)}),e.jsxs(y,{className:Y("text-right",s.adjustments>=0?"text-green-600":"text-red-600"),children:[s.adjustments>=0?"+":"",k(s.adjustments)]}),e.jsx(y,{className:"text-right font-semibold",children:k(s.net)})]},s.id))}),e.jsx(re,{children:e.jsxs(P,{children:[e.jsx(y,{colSpan:3,className:"text-right font-semibold",children:"Batch Total:"}),e.jsx(y,{className:"text-right font-bold",children:k(I.reduce((s,l)=>s+l.net,0))})]})})]})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Adjustment Lines"}),d.length===0&&e.jsx("div",{className:"text-xs text-gray-500 border rounded p-3",children:"No adjustments added yet."}),d.length>0&&e.jsx("div",{className:"overflow-x-auto border rounded",children:e.jsxs(G,{children:[e.jsx(_,{children:e.jsxs(P,{children:[e.jsx(v,{children:"Employee"}),e.jsx(v,{children:"Type"}),e.jsx(v,{className:"text-right",children:"Amount"}),e.jsx(v,{children:"Reason"}),e.jsx(v,{children:" "})]})}),e.jsx(V,{children:d.map(s=>{const l=h.find(p=>p.id===s.employeeId);return e.jsxs(P,{children:[e.jsx(y,{children:(l==null?void 0:l.name)||s.employeeId}),e.jsx(y,{className:"capitalize text-xs",children:s.type}),e.jsxs(y,{className:Y("text-right text-sm",s.type==="deduction"?"text-red-600":"text-green-600"),children:[s.type==="deduction"&&"-",k(s.amount)]}),e.jsx(y,{className:"text-xs max-w-[240px] truncate",title:s.reason,children:s.reason}),e.jsxs(y,{className:"text-right space-x-2",children:[e.jsx("button",{onClick:()=>N(s.id),className:"text-xs text-blue-600 hover:underline",children:"Edit"}),e.jsx("button",{onClick:()=>b(s.id),className:"text-xs text-red-600 hover:underline",children:"Remove"})]})]},s.id)})})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border rounded p-4 space-y-3 bg-gray-50",children:[e.jsx("h4",{className:"text-sm font-semibold",children:u?"Edit Adjustment":"Add Adjustment"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium block mb-1",children:"Employee"}),e.jsxs("select",{value:n.employeeId,onChange:s=>m(l=>({...l,employeeId:s.target.value})),className:"w-full border rounded px-2 py-1 text-sm",children:[e.jsx("option",{value:"",children:"Select employee..."}),h.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium block mb-1",children:"Type"}),e.jsx("select",{value:n.type,onChange:s=>m(l=>({...l,type:s.target.value})),className:"w-full border rounded px-2 py-1 text-sm",children:$e.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium block mb-1",children:"Amount"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:n.amount,onChange:s=>m(l=>({...l,amount:s.target.value})),className:"w-full border rounded px-2 py-1 text-sm",placeholder:"0.00"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium block mb-1",children:"Reason"}),e.jsx("input",{type:"text",value:n.reason,onChange:s=>m(l=>({...l,reason:s.target.value})),className:"w-full border rounded px-2 py-1 text-sm",placeholder:"Optional"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{type:"button",onClick:g,className:"flex-1",disabled:!n.employeeId||!n.amount,children:u?"Update":"Add"}),u&&e.jsx(C,{type:"button",variant:"outline",onClick:S,children:"Cancel"})]}),c&&e.jsx("div",{className:"text-[11px] text-red-600",children:c})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 leading-relaxed",children:[e.jsx("p",{children:"Rules (future validation):"}),e.jsxs("ul",{className:"list-disc ml-4 mt-1 space-y-1",children:[e.jsx("li",{children:"Deductions cannot exceed base net."}),e.jsx("li",{children:"Overtime may have tiered multipliers."}),e.jsx("li",{children:"Track taxable vs non-taxable allowances."})]})]}),t.adjustmentAudit&&t.adjustmentAudit.length>0&&e.jsxs("div",{className:"border rounded p-3 bg-white/50 max-h-48 overflow-auto",children:[e.jsx("h4",{className:"font-semibold text-xs mb-2",children:"Adjustment Audit"}),e.jsx("ul",{className:"space-y-1 text-[11px]",children:t.adjustmentAudit.slice().reverse().map(s=>{var l;return e.jsxs("li",{children:[new Date(s.at).toLocaleString()," - ",s.action.toUpperCase()," #",s.adjustmentId.slice(0,6)," ",((l=s.details)==null?void 0:l.amount)&&`(amt:${s.details.amount})`]},s.at+s.adjustmentId)})})]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(C,{variant:"outline",onClick:i,children:[e.jsx(W,{className:"mr-1 h-4 w-4"}),"Back"]}),e.jsxs(C,{onClick:()=>r(),children:["Continue",e.jsx(q,{className:"ml-1 h-4 w-4"})]})]})]})},Be=({onNext:r,onBack:i,payrollData:t})=>{var d,c;const a=((d=t.calculations)==null?void 0:d.reduce((o,g)=>o+g.net,0))||0,n=ke(t),[m,u]=f.useState(!1),x=async()=>{const o=await ye.exportCSV(t.id,{includeTemporary:m}),g=new Blob([o],{type:"text/csv"}),b=URL.createObjectURL(g),N=document.createElement("a");N.href=b,N.download=`WPS-${t.month}-${t.year}.csv`,N.click(),URL.revokeObjectURL(b)},h=()=>{oe.generateForBatch(t.id),r({approved:!0})};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Review & Approve"}),e.jsxs("div",{className:"border rounded p-4 bg-gray-50 text-sm space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Period:"}),e.jsxs("span",{children:[t.month,"/",t.year]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Employees:"}),e.jsx("span",{children:((c=t.calculations)==null?void 0:c.length)||0})]}),e.jsxs("div",{className:"flex justify-between font-medium",children:[e.jsx("span",{children:"Total Net Payroll:"}),e.jsx("span",{children:k(a)})]}),e.jsx("div",{className:"pt-2 text-xs",children:n.issues.length===0?e.jsx("span",{className:"text-green-600",children:"No validation issues."}):e.jsx("ul",{className:"space-y-1 max-h-40 overflow-auto",children:n.issues.map(o=>e.jsxs("li",{className:o.severity==="error"?"text-red-600":"text-amber-600",children:["[",o.severity.toUpperCase(),"] ",o.message]},o.code+o.employeeId))})}),e.jsx("div",{className:"flex items-center gap-3 text-xs pt-2",children:e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:o=>u(o.target.checked)}),"Include Temporary in WPS"]})})]}),e.jsxs("div",{className:"flex justify-between pt-2",children:[e.jsxs(C,{variant:"outline",onClick:i,children:[e.jsx(W,{className:"mr-1 h-4 w-4"}),"Back"]}),e.jsx(C,{variant:"outline",onClick:x,children:"Export WPS CSV"}),e.jsxs(C,{disabled:n.hasErrors,onClick:h,children:["Approve & Generate Payslips",e.jsx(ie,{className:"ml-1 h-4 w-4"})]})]})]})},Le=({onBack:r,payrollData:i})=>{const[t,a]=f.useState(!1),n=async()=>{a(!0);try{await Ae(i.id)}finally{a(!1)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Payslips"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Payslips ready for batch ",i.id,". Download combined PDF below."]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(C,{variant:"outline",onClick:r,children:[e.jsx(W,{className:"mr-1 h-4 w-4"}),"Back"]}),e.jsx(C,{variant:"outline",disabled:t,onClick:n,children:t?"Generating…":"Download PDF"}),e.jsx(C,{onClick:()=>window.history.back(),children:"Finish"})]})]})},Je=()=>{const r=ve(),[i,t]=f.useState(0),a=new Date().getMonth()+1,n=new Date().getFullYear(),[m,u]=f.useState(()=>w.getDraft(a,n)||w.createDraft(a,n)),x=[{title:"Select Period",icon:be},{title:"Review Attendance",icon:ge},{title:"Calculate Salaries",icon:Ne},{title:"Add Adjustments",icon:Ce},{title:"Review & Approve",icon:we},{title:"Generate Payslips",icon:fe}];return e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsx("div",{className:"mb-8 overflow-x-auto",children:e.jsx("ol",{className:"flex items-center gap-6",children:x.map((h,d)=>{const c=h.icon,o=d===i?"active":d<i?"done":"upcoming";return e.jsxs("li",{className:"flex items-center gap-2 min-w-[140px]",children:[e.jsx("div",{className:Y("h-10 w-10 rounded-full flex items-center justify-center text-white text-sm font-medium",o==="done"&&"bg-green-600",o==="active"&&"bg-blue-600 ring-4 ring-blue-100",o==="upcoming"&&"bg-gray-300 text-gray-700"),children:o==="done"?e.jsx(ie,{className:"h-5 w-5"}):e.jsx(c,{className:"h-5 w-5"})}),e.jsx("span",{className:Y("text-xs font-medium",o==="active"&&"text-blue-700"),children:h.title})]},h.title)})})}),e.jsx(Ee,{children:e.jsxs(Pe,{className:"p-6 space-y-4",children:[i===0&&e.jsx(Oe,{payrollData:m,setPayrollData:u,onNext:()=>t(1)}),i===1&&e.jsx(Re,{payrollData:m,setPayrollData:u,onBack:()=>t(0),onNext:()=>t(2)}),i===2&&e.jsx(Fe,{payrollData:m,onBack:()=>t(1),onNext:h=>{u(d=>{const c={...d,calculations:h.calculations};return w.updateCalculations(d.id,h.calculations),c}),t(3)}}),i===3&&e.jsx(He,{payrollData:m,setPayrollData:u,onBack:()=>t(2),onNext:()=>t(4)}),i===4&&e.jsx(Be,{payrollData:m,setPayrollData:u,onBack:()=>t(3),onNext:()=>{u(h=>{const d={...h,status:"approved"};return w.approve(h.id),d}),t(5)}}),i===5&&e.jsx(Le,{payrollData:m,setPayrollData:u,onBack:()=>t(4),onNext:()=>{u(h=>{const d={...h,status:"processed"};return w.markProcessed(h.id),d}),r("/payroll/history")}})]})})]})};export{Je as ProcessPayrollPage,Je as default};
//# sourceMappingURL=ProcessPayroll-DlrPkxcU.js.map
