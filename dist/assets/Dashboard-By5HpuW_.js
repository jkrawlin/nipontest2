import{j as e}from"./vendor-ds6wDdAD.js";import{r as p}from"./react-nPrKd0zk.js";import{C as a,a as n,b as l,d as i,c as R}from"./card-DuYZQIZY.js";import{f as F}from"./formatters-CZgibOAZ.js";import{B as I}from"./badge-D-J4CWRb.js";import{E as f}from"./employees-D2MDJNGt.js";import{P as N}from"./payroll-Cm_R0hmF.js";import{C as z}from"./customers-qEHjyBNn.js";import"./index-sMHxiCIB.js";import"./employees-DNNZe7Q5.js";import"./decimal-CNRKZ6of.js";const V=()=>{const[t,v]=p.useState(null),[h,E]=p.useState([]),[C,D]=p.useState(!0);return p.useEffect(()=>{(async()=>{try{const r=await f.getAllEmployees(),b=r.filter(s=>s.status==="Active"),m=await f.getExpiringDocuments(120),w=new Date().getMonth()+1,P=new Date().getFullYear(),j=N.list().filter(s=>s.month===w&&s.year===P).reduce((s,c)=>{var o;return s+(((o=c.calculations)==null?void 0:o.reduce((y,g)=>y+g.net,0))||0)},0),d=new Date;d.setMonth(d.getMonth()-1);const x=N.list().filter(s=>s.month===d.getMonth()+1&&s.year===d.getFullYear()).reduce((s,c)=>{var o;return s+(((o=c.calculations)==null?void 0:o.reduce((y,g)=>y+g.net,0))||0)},0),M=new Set(r.filter(s=>s.employeeType==="Permanent").map(s=>s.employment.department)).size,S=new Set(r.map(s=>s.personalInfo.nationality)).size,T=m.filter(s=>s.status==="critical").length,L=m.filter(s=>s.status==="warning").length,A=m.filter(s=>s.status==="expired").length,u=z.getAll(),B=u.reduce((s,c)=>s+c.financial.currentMonthRevenue,0);v({totalEmployees:r.length,activeEmployees:b.length,onLeaveEmployees:r.filter(s=>s.status==="On Leave").length,documentsCritical:T,documentsWarning:L,documentsExpired:A,currentMonthPayroll:j,lastMonthPayroll:x,payrollTrend:x>0?(j-x)/x*100:0,departments:M,nationalities:S,totalCustomers:u.length,activeCustomers:u.filter(s=>s.status==="Active").length,customerMonthlyRevenue:B}),E(m.slice(0,8))}finally{D(!1)}})()},[]),C?e.jsx("div",{className:"p-6 text-sm text-gray-500",children:"Loading dashboard…"}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Dashboard"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Operational overview & compliance snapshot"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:[e.jsxs(a,{children:[e.jsx(n,{children:e.jsx(l,{className:"text-sm font-medium text-gray-500",children:"Total Employees"})}),e.jsxs(i,{children:[e.jsx("p",{className:"text-2xl font-bold",children:t==null?void 0:t.totalEmployees}),e.jsxs("p",{className:"text-[11px] text-gray-500",children:[t==null?void 0:t.activeEmployees," active"]})]})]}),e.jsxs(a,{children:[e.jsx(n,{children:e.jsx(l,{className:"text-sm font-medium text-gray-500",children:"This Month Payroll"})}),e.jsxs(i,{children:[e.jsx("p",{className:"text-2xl font-bold",children:F((t==null?void 0:t.currentMonthPayroll)||0)}),e.jsxs("p",{className:"text-[11px] text-gray-500",children:["Trend ",t&&t.payrollTrend.toFixed(1),"%"]})]})]}),e.jsxs(a,{children:[e.jsx(n,{children:e.jsx(l,{className:"text-sm font-medium text-gray-500",children:"Document Alerts"})}),e.jsxs(i,{children:[e.jsx("p",{className:"text-2xl font-bold",children:((t==null?void 0:t.documentsCritical)||0)+((t==null?void 0:t.documentsExpired)||0)}),e.jsxs("p",{className:"text-[11px] text-gray-500",children:[t==null?void 0:t.documentsExpired," expired"]})]})]}),e.jsxs(a,{children:[e.jsx(n,{children:e.jsx(l,{className:"text-sm font-medium text-gray-500",children:"Departments"})}),e.jsxs(i,{children:[e.jsx("p",{className:"text-2xl font-bold",children:t==null?void 0:t.departments}),e.jsxs("p",{className:"text-[11px] text-gray-500",children:[t==null?void 0:t.nationalities," nationalities"]})]})]}),e.jsxs(a,{children:[e.jsx(n,{children:e.jsx(l,{className:"text-sm font-medium text-gray-500",children:"Customers"})}),e.jsxs(i,{children:[e.jsx("p",{className:"text-2xl font-bold",children:t==null?void 0:t.totalCustomers}),e.jsxs("p",{className:"text-[11px] text-gray-500",children:[t==null?void 0:t.activeCustomers," active"]})]})]})]}),h.length>0&&e.jsxs(a,{children:[e.jsxs(n,{children:[e.jsx(l,{children:"Upcoming Expiries"}),e.jsx(R,{children:"Top priority documents (next 120 days)"})]}),e.jsx(i,{children:e.jsxs("div",{className:"divide-y",children:[h.map(r=>e.jsxs("div",{className:"flex items-center justify-between py-2 text-sm",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:r.employeeName}),e.jsxs("span",{className:"text-[11px] text-gray-500",children:[r.documentType," – ",new Date(r.expiryDate).toLocaleDateString("en-GB")]})]}),e.jsx(I,{variant:r.status==="expired"?"destructive":r.status==="critical"?"outline":"secondary",className:r.status==="critical"?"border-amber-500 text-amber-700":"",children:r.status==="expired"?"EXPIRED":`${r.daysRemaining}d`})]},r.employeeId+r.documentType)),h.length===0&&e.jsx("div",{className:"text-xs text-gray-500 py-4",children:"No upcoming expiries in window."})]})})]})]})};export{V as DashboardPage};
//# sourceMappingURL=Dashboard-By5HpuW_.js.map
