var f=Object.defineProperty;var y=(r,t,e)=>t in r?f(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var v=(r,t,e)=>y(r,typeof t!="symbol"?t+"":t,e);import{C as S}from"./customers-qEHjyBNn.js";class h{static getAll(){try{const t=localStorage.getItem(this.STORAGE_KEY);return t?JSON.parse(t):[]}catch{return[]}}static getByCustomer(t){return this.getAll().filter(e=>e.customerId===t)}static createDraft(t){const e=S.getById(t.customerId);if(!e)return;const c=e.deployment.currentEmployees.filter(i=>t.includeInactive||i.status==="Active"),l=[];c.forEach(i=>{const n=e.rates.defaultRates.find(a=>a.position===i.position);if(n){let a=1,m=n.normalRate;n.rateType==="Daily"?a=30:n.rateType==="Hourly"&&(a=8*22);const I=a*m;l.push({description:`${i.position} - ${n.rateType}`,position:i.position,quantity:a,unitRate:m,amount:I})}});const u=l.reduce((i,n)=>i+n.amount,0),d=e.billing.vatRegistered?u*.05:0,o=u+d,s=new Date,g={id:crypto.randomUUID(),invoiceNumber:this.generateInvoiceNumber(),customerId:e.id,periodStart:t.periodStart,periodEnd:t.periodEnd,issueDate:s.toISOString(),dueDate:new Date(s.getTime()+1e3*60*60*24*30).toISOString(),currency:e.billing.currency,lines:l,subtotal:u,vatAmount:d,total:o,status:"Draft",createdAt:s.toISOString()},p=this.getAll();return p.push(g),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(p)),S.update(e.id,{billing:{...e.billing,lastInvoiceDate:s.toISOString(),lastInvoiceAmount:o},financial:{...e.financial,totalRevenue:e.financial.totalRevenue+o,currentMonthRevenue:e.financial.currentMonthRevenue+o}}),g}static generateInvoiceNumber(){const t=new Date().getFullYear(),e=this.getAll().filter(c=>c.invoiceNumber.startsWith(`INV-${t}`)).length+1;return`INV-${t}-${String(e).padStart(4,"0")}`}}v(h,"STORAGE_KEY","nipon_customer_invoices");export{h as I};
//# sourceMappingURL=invoices-CLR50L-3.js.map
